@startuml
title Sequence Diagram: Adding a New Warehouse

actor "User" as User

participant "MainView:\nMainViewController" as MainVC
participant "WarehouseDialog:\nWarehouseDialogController" as DialogVC
participant "WarehouseService" as Service
participant "WarehouseDao:\nWarehouseDaoImpl" as DAO
database "Database" as DB

autonumber "<b>[00]"

User -> MainVC : clicks 'Add Warehouse' button
activate MainVC

MainVC -> DialogVC ++ : shows Dialog (FXMLLoader.load(), controller.setWarehouse(null))
DialogVC --> User -- : displays Warehouse Dialog

User -> DialogVC : enters name & location
User -> DialogVC : clicks 'OK' button
activate DialogVC

DialogVC -> DialogVC : processResults() (validates input)
alt Input Valid
    DialogVC --> MainVC -- : returns newWarehouse (Warehouse object)
    deactivate DialogVC

    activate MainVC
    MainVC -> Service ++ : saveWarehouse(newWarehouse)

    Service -> DAO ++ : findByName(newWarehouse.getName())
    DAO -> DB ++ : SELECT query (check for duplicates)
    DB --> DAO -- : (null or existing warehouse)
    DAO --> Service -- : (null or existing warehouse)
    ' Asumsikan validasi nama unik berhasil (tidak ada duplikat untuk warehouse baru)

    Service -> DAO ++ : save(newWarehouse)
    DAO -> DB ++ : INSERT newWarehouse
    DB --> DAO -- : (success)
    DAO --> Service -- : (success)
    deactivate DAO

    Service --> MainVC -- : (void or success indicator)
    deactivate Service

    MainVC -> MainVC : loadWarehouses() (UI refresh)
    MainVC -> MainVC : statusLabel.setText("Success...")
    MainVC --> User : displays updated Warehouse List & success message
else Input Invalid
    DialogVC --> User -- : displays error message in Dialog
    ' User tetap di dialog atau membatalkan.
    ' Jika membatalkan, DialogVC akan di-deactivate saat dialog ditutup.
    ' Untuk kesederhanaan, kita tidak detailkan loop koreksi di sini.
    deactivate DialogVC
end
deactivate MainVC

@enduml